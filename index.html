import React, { useState, useEffect, useCallback, useRef } from 'react';
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';

// Global Firebase variables provided by the environment
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
// FIX: Changed __initialAuthToken to __initial_auth_token to resolve ReferenceError
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

// API Keys (leave as empty string, Canvas provides them at runtime)
const ELEVENLABS_API_KEY = ""; // For Text-to-Speech

// --- Custom Alert/Message Box Component ---
const CustomMessageBox = ({ message, onClose }) => {
    if (!message) return null;

    return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div className="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center animate-fade-in">
                <p className="text-lg mb-4 text-gray-800">{message}</p>
                <button
                    onClick={onClose}
                    className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105"
                >
                    OK
                </button>
            </div>
        </div>
    );
};

// --- Reusable Copy to Clipboard Button Component ---
const CopyToClipboardButton = ({ textToCopy, showMessage }) => {
    const handleCopy = async () => {
        if (!textToCopy) {
            showMessage("Nothing to copy!");
            return;
        }
        try {
            const textarea = document.createElement('textarea');
            textarea.value = textToCopy;
            textarea.style.position = 'fixed'; // Prevent scrolling to bottom of page
            textarea.style.opacity = 0; // Hide it
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            showMessage("Copied to clipboard!");
        } catch (err) {
            console.error('Failed to copy text:', err);
            showMessage("Failed to copy. Please try again or copy manually.");
        }
    };

    return (
        <button
            onClick={handleCopy}
            className="ml-2 px-3 py-1 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition duration-200 text-sm flex items-center justify-center"
            title="Copy to clipboard"
        >
            <svg className="w-4 h-4 inline-block align-middle" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 5H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-2m-4-4l4-4m0 0l-4 4m4-4H9m-4 4l-4 4m0 0l4-4m-4 4h9"></path></svg>
            <span className="ml-1 hidden sm:inline">Copy</span>
        </button>
    );
};

// --- Watermark Function ---
const addWatermarkToImage = (base64Image, watermarkText, showMessage) => {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.src = base64Image;
        img.onload = () => {
            const canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext('2d');

            ctx.drawImage(img, 0, 0);

            // Watermark settings
            const fontSize = Math.max(20, img.width / 30); // Dynamic font size
            ctx.font = `bold ${fontSize}px Inter, sans-serif`;
            ctx.fillStyle = 'rgba(255, 255, 255, 0.6)'; // White with transparency
            ctx.textAlign = 'right';
            ctx.textBaseline = 'bottom';

            // Calculate position (bottom right corner with padding)
            const padding = Math.max(10, img.width / 100);
            const x = img.width - padding;
            const y = img.height - padding;

            ctx.fillText(watermarkText, x, y);

            resolve(canvas.toDataURL('image/png'));
        };
        img.onerror = (error) => {
            console.error("Error loading image for watermarking:", error);
            showMessage("Failed to load image for watermarking.");
            reject(error);
        };
    });
};

// --- Function to draw text on an image ---
const drawTextOnBase64Image = (base64Image, textToDraw, showMessage) => {
    return new Promise((resolve, reject) => {
        if (!textToDraw) {
            resolve(base64Image); // No text to draw, return original image
            return;
        }

        const img = new Image();
        img.src = base64Image;
        img.onload = () => {
            const canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext('2d');

            ctx.drawImage(img, 0, 0);

            // Text settings
            const idealFontSize = Math.max(24, img.width / 15); // Adjust font size based on image width
            ctx.font = `bold ${idealFontSize}px Inter, sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'alphabetic';

            const maxWidth = img.width * 0.8; // 80% of image width
            const lineHeight = idealFontSize * 1.2; // 120% of font size

            const words = textToDraw.split(' ');
            let line = '';
            let lines = [];

            // Simple text wrapping (can be improved for more complex cases)
            for (let n = 0; n < words.length; n++) {
                const testLine = line + words[n] + ' ';
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;
                if (testWidth > maxWidth && n > 0) {
                    lines.push(line);
                    line = words[n] + ' ';
                } else {
                    line = testLine;
                }
            }
            lines.push(line);

            // Calculate starting Y position to center multiple lines at the bottom
            const totalTextHeight = lines.length * lineHeight;
            const startY = img.height - (totalTextHeight / 2) - (img.height * 0.05); // 5% from bottom

            for (let i = 0; i < lines.length; i++) {
                const currentLineY = startY + (i * lineHeight);

                // Add a text shadow or stroke for better readability
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 4; // Thickness of the stroke
                ctx.lineJoin = 'round'; // Sharper corners for text stroke
                ctx.miterLimit = 2; // Prevents overly sharp corners

                ctx.strokeText(lines[i], canvas.width / 2, currentLineY);

                ctx.fillStyle = 'white'; // Fill text with white
                ctx.fillText(lines[i], canvas.width / 2, currentLineY);
            }

            resolve(canvas.toDataURL('image/png'));
        };
        img.onerror = (error) => {
            console.error("Error loading image for text drawing:", error);
            showMessage("Failed to load image for adding text.");
            reject(error);
        };
    });
};


// --- Speech Synthesis (TTS) Hook using Eleven Labs API ---
const useSpeechSynthesis = (elevenLabsApiKey, showMessage) => {
    const [isSpeaking, setIsSpeaking] = useState(false);
    const audioRef = useRef(null);

    const speak = useCallback(async (text) => {
        if (!elevenLabsApiKey) {
            showMessage("ElevenLabs API key is not configured. Text-to-Speech will not work.");
            return;
        }
        if (!text) {
            console.warn("Attempted to speak empty text.");
            return;
        }

        if (audioRef.current && !audioRef.current.paused) {
            audioRef.current.pause();
            audioRef.current.removeAttribute('src');
            audioRef.current.load();
        }

        setIsSpeaking(true);

        try {
            if (!window.AudioContext && !window.webkitAudioContext) {
                showMessage("Your browser does not support Web Audio API. Please update your browser.");
                setIsSpeaking(false);
                return;
            }

            const voiceId = 'EXAVITQu4vr4xnSDxMaL'; // Default voice: Bella
            const modelId = 'eleven_turbo_v2_5'; // Low-latency model

            const payload = {
                text: text,
                model_id: modelId,
                voice_settings: {
                    stability: 0.5,
                    similarity_boost: 0.75,
                },
            };

            const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}/stream`, {
                method: 'POST',
                headers: {
                    'Accept': 'audio/mpeg',
                    'Content-Type': 'application/json',
                    'xi-api-key': elevenLabsApiKey,
                },
                body: JSON.stringify(payload),
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.detail ? errorData.detail : JSON.stringify(errorData);
                throw new Error(`ElevenLabs API error: ${response.status} ${response.statusText} - ${errorMessage}`);
            }

            const audioBlob = await response.blob();
            const audioUrl = URL.createObjectURL(audioBlob);

            audioRef.current = new Audio(audioUrl);
            audioRef.current.onended = () => {
                setIsSpeaking(false);
                URL.revokeObjectURL(audioUrl);
            };
            audioRef.current.onerror = (e) => {
                console.error('Audio playback error (ElevenLabs):', e);
                showMessage('Error playing audio from ElevenLabs. Please try again.');
                setIsSpeaking(false);
                URL.revokeObjectURL(audioUrl);
            };

            await audioRef.current.play();
        } catch (error) {
            console.error('Error with ElevenLabs Text-to-Speech:', error);
            showMessage(`Text-to-Speech failed: ${error.message}`);
            setIsSpeaking(false);
        }
    }, [elevenLabsApiKey, showMessage]);

    const stopSpeaking = useCallback(() => {
        if (audioRef.current) {
            audioRef.current.pause();
            audioRef.current.currentTime = 0;
            setIsSpeaking(false);
            if (audioRef.current.src) {
                URL.revokeObjectURL(audioRef.current.src);
                audioRef.current.removeAttribute('src');
                audioRef.current.load();
            }
        }
    }, []);

    useEffect(() => {
        return () => {
            if (audioRef.current) {
                stopSpeaking();
            }
        };
    }, [stopSpeaking]);

    return { speak, stopSpeaking, isSpeaking };
};


// --- Speech Recognition (STT) Hook using WebkitSpeechRecognition ---
const useSpeechRecognition = (onResult, onError, showMessage) => {
    const [isListening, setIsListening] = useState(false);
    const [interimTranscript, setInterimTranscript] = useState('');
    const recognitionRef = useRef(null);

    useEffect(() => {
        if (!('webkitSpeechRecognition' in window)) {
            navigator.mediaDevices.enumerateDevices().then(devices => {
                const hasMicrophone = devices.some(device => device.kind === 'audioinput');
                if (!hasMicrophone) {
                    showMessage("No microphone detected. Please connect a microphone to use voice input.");
                } else {
                    showMessage("Speech-to-Text is not supported in your browser. Please use Chrome or a compatible browser.");
                }
            }).catch(e => {
                console.error("Error enumerating media devices:", e);
                showMessage("Speech-to-Text is not supported or there was an error checking microphone access in your browser.");
            });
            return;
        }

        const recognition = new window.webkitSpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = true;
        recognition.lang = 'en-IN'; // Default to Indian English

        recognition.onstart = () => {
            setIsListening(true);
            setInterimTranscript('');
            console.log('Speech recognition started...');
        };

        recognition.onresult = (event) => {
            let finalTranscript = '';
            let currentInterimTranscript = '';

            for (let i = event.resultIndex; i < event.results.length; i++) {
                const transcript = event.results[i][0].transcript;
                if (event.results[i].isFinal) {
                    finalTranscript += transcript;
                } else {
                    currentInterimTranscript += transcript;
                }
            }
            setInterimTranscript(currentInterimTranscript);
            if (finalTranscript) {
                onResult(finalTranscript.trim());
            }
        };

        recognition.onerror = (event) => {
            setIsListening(false);
            setInterimTranscript('');
            console.error('Speech recognition error event:', event);
            console.error('Specific Speech recognition error type:', event.error);

            let errorMessage = "Speech recognition error. Please try again.";
            if (event.error) {
                if (event.error === 'no-speech') {
                    errorMessage = 'No speech detected. Please ensure your microphone is on and speak clearly.';
                } else if (event.error === 'not-allowed') {
                    errorMessage = 'Microphone access denied. Please allow microphone permissions for this site in your browser settings, then refresh the page.';
                } else if (event.error === 'aborted') {
                    errorMessage = 'Speech recognition was stopped.';
                } else if (event.error === 'network') {
                    errorMessage = 'Network error during speech recognition.';
                } else if (event.error === 'language-not-supported') {
                    errorMessage = 'The selected language is not supported for speech recognition.';
                } else {
                    errorMessage = `Speech recognition error: ${event.error}.`;
                }
            }
            onError(errorMessage);
            showMessage(errorMessage);
        };

        recognition.onend = () => {
            setIsListening(false);
            if (interimTranscript) {
                onResult(interimTranscript.trim());
            }
            setInterimTranscript('');
            console.log('Speech recognition ended.');
        };

        recognitionRef.current = recognition;

        return () => {
            if (recognitionRef.current) {
                recognitionRef.current.stop();
            }
        };
    }, [onResult, onError, showMessage, interimTranscript]);

    const startListening = useCallback(async () => {
        if (recognitionRef.current && !isListening) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop()); // Stop tracks immediately after checking
                recognitionRef.current.start();
            } catch (err) {
                if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                    showMessage('Microphone access denied. Please enable it in your browser settings to use speech input.');
                } else if (err.name === 'NotFoundError') {
                    showMessage('No microphone found. Please ensure a microphone is connected.');
                } else {
                    console.error('Error accessing microphone:', err);
                    showMessage(`Could not access microphone: ${err.message}.`);
                }
                setIsListening(false);
            }
        }
    }, [isListening, showMessage]);

    const stopListening = useCallback(() => {
        if (recognitionRef.current && isListening) {
            recognitionRef.current.stop();
        }
    }, [isListening]);

    return { startListening, stopListening, isListening, interimTranscript };
};

// --- Feedback Buttons Component ---
const FeedbackButtons = ({ showMessage, outputId }) => {
    const [feedback, setFeedback] = useState(null); // 'liked', 'disliked', or null

    const handleFeedback = (type) => {
        setFeedback(type);
        if (type === 'liked') {
            showMessage("Thank you for your positive feedback!");
        } else {
            showMessage("Thank you for your feedback. We'll use it to improve.");
        }
        // In a real application, you would send this feedback to a backend/database
        console.log(`Feedback for ${outputId}: ${type}`);
    };

    return (
        <div className="flex justify-end gap-2 mt-4 text-gray-500">
            <button
                onClick={() => handleFeedback('liked')}
                className={`feedback-button ${feedback === 'liked' ? 'liked' : 'hover:bg-gray-100'}`}
                title="Like this response"
            >
                üëç
            </button>
            <button
                onClick={() => handleFeedback('disliked')}
                className={`feedback-button ${feedback === 'disliked' ? 'disliked' : 'hover:bg-gray-100'}`}
                title="Dislike this response"
            >
                üëé
            </button>
        </div>
    );
};


// --- Home Content Component ---
const HomeContent = () => (
    <div className="text-center py-10">
        {/* Added animation to the title */}
        <h2 className="text-4xl font-extrabold text-gray-800 mb-6 animate-pulse-light">Welcome to Nithin AI Studio!</h2>
        <p className="text-xl text-gray-600 mb-10 animate-fade-in animation-delay-200">Your all-in-one AI companion for creativity, knowledge, and assistance.</p>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-4xl mx-auto">
            <div className="bg-gradient-to-br from-blue-100 to-indigo-100 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up">
                <img
                    src="https://placehold.co/150x100/a7d9ff/004c99?text=Image+Gen"
                    alt="Image Generation Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-blue-800 mb-2">Unleash Creativity</h3>
                <p className="text-gray-700 text-center text-sm">Generate stunning images from text descriptions.</p>
            </div>

            <div className="bg-gradient-to-br from-green-100 to-lime-100 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-100">
                <img
                    src="https://placehold.co/150x100/c7f0d0/007a33?text=Farmer+AI"
                    alt="Farmer AI Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-green-800 mb-2">Smart Farming Insights</h3>
                <p className="text-gray-700 text-center text-sm">Detect crop diseases and chat with NFI for advice.</p>
            </div>

            <div className="bg-gradient-to-br from-purple-100 to-pink-100 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-200">
                <img
                    src="https://placehold.co/150x100/e8c7f0/800080?text=Live+Chat"
                    alt="Live Chat Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-purple-800 mb-2">Conversational AI</h3>
                <p className="text-gray-700 text-center text-sm">Experience live voice chat with intelligent AI.</p>
            </div>

            <div className="bg-gradient-to-br from-yellow-100 to-orange-100 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-300">
                <img
                    src="https://placehold.co/150x100/ffe4b3/995c00?text=Summarize"
                    alt="Text Summarizer Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-orange-800 mb-2">Quick Summaries</h3>
                <p className="text-gray-700 text-center text-sm">Get concise summaries of long texts instantly.</p>
            </div>

            <div className="bg-gradient-to-br from-red-100 to-pink-100 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-400">
                <img
                    src="https://placehold.co/150x100/ffb3b3/990000?text=Translate"
                    alt="Text Translator Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-red-800 mb-2">Bridge Language Gaps</h3>
                <p className="text-gray-700 text-center text-sm">Translate text between numerous languages.</p>
            </div>

            <div className="bg-gradient-to-br from-cyan-100 to-teal-100 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-500">
                <img
                    src="https://placehold.co/150x100/b3ffe4/008080?text=Govt+Schemes"
                    alt="Government Schemes Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-teal-800 mb-2">Government Insights</h3>
                <p className="text-gray-700 text-center text-sm">Find relevant government schemes easily.</p>
            </div>
            <div className="bg-gradient-to-br from-gray-100 to-slate-100 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-600">
                <img
                    src="https://placehold.co/150x100/d9d9d9/555555?text=AI+Content"
                    alt="AI Content Studio Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-slate-800 mb-2">AI Content Studio</h3>
                <p className="text-gray-700 text-center text-sm">Generate and enhance content with AI-powered suggestions, voice input/output.</p>
            </div>
            <div className="bg-gradient-to-br from-orange-100 to-amber-100 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-700">
                <img
                    src="https://placehold.co/150x100/ffe0b3/cc7a00?text=Creative+Writing"
                    alt="Creative Writing Assistant Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-orange-800 mb-2">Creative Writing</h3>
                <p className="text-gray-700 text-center text-sm">Generate stories, poems, or brainstorm ideas with AI.</p>
            </div>
            <div className="bg-gradient-to-br from-lime-50 to-green-50 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-800">
                <img
                    src="https://placehold.co/150x100/e0ffb3/558000?text=Meal+Planner"
                    alt="Meal Planner Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-green-800 mb-2">Meal Planner</h3>
                <p className="text-gray-700 text-center text-sm">Get recipes from ingredients with AI's help.</p>
            </div>
            {/* New tools for HomeContent */}
            <div className="bg-gradient-to-br from-purple-50 to-indigo-50 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-900">
                <img
                    src="https://placehold.co/150x100/e6e6fa/6a0dad?text=Sentiment"
                    alt="Sentiment Analysis Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-purple-800 mb-2">Sentiment Analyzer</h3>
                <p className="text-gray-700 text-center text-sm">Understand the emotion behind text.</p>
            </div>
            <div className="bg-gradient-to-br from-teal-50 to-cyan-50 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-1000">
                <img
                    src="https://placehold.co/150x100/e0ffff/008080?text=Keywords"
                    alt="Keyword Extraction Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-teal-800 mb-2">Keyword Extractor</h3>
                <p className="text-gray-700 text-center text-sm">Pull out important keywords from text.</p>
            </div>
            <div className="bg-gradient-to-br from-yellow-50 to-orange-50 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-1100">
                <img
                    src="https://placehold.co/150x100/fffacd/daa520?text=Q%26A"
                    alt="Q&A Bot Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-orange-800 mb-2">Q&A Bot</h3>
                <p className="text-gray-700 text-center text-sm">Get answers from provided text or general knowledge.</p>
            </div>
            <div className="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-1200">
                <img
                    src="https://placehold.co/150x100/e6e6fa/4682b4?text=Grammar"
                    alt="Grammar Corrector Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-blue-800 mb-2">Grammar Corrector</h3>
                <p className="text-gray-700 text-center text-sm">Improve your text's grammar and readability.</p>
            </div>
            <div className="bg-gradient-to-br from-gray-50 to-slate-50 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-1300">
                <img
                    src="https://placehold.co/150x100/f0f0f0/696969?text=Debugger"
                    alt="Code Debugger Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-gray-800 mb-2">Code Debugger</h3>
                <p className="text-gray-700 text-center text-sm">Get help debugging your code (placeholder).</p>
            </div>
            <div className="bg-gradient-to-br from-pink-50 to-rose-50 p-6 rounded-lg shadow-lg flex flex-col items-center transform hover:scale-105 transition-transform duration-300 animate-slide-in-up animation-delay-1400">
                <img
                    src="https://placehold.co/150x100/ffe4e1/b22222?text=Recipes"
                    alt="Recipe Adjuster Banner"
                    className="w-full h-auto rounded-md mb-4 shadow"
                    onError={(e) => { e.target.onerror = null; e.target.src = 'https://placehold.co/150x100?text=Error'; }}
                />
                <h3 className="text-xl font-semibold text-pink-800 mb-2">Recipe Adjuster</h3>
                <p className="text-gray-700 text-center text-sm">Adjust recipe servings or ingredients (placeholder).</p>
            </div>
        </div>
    </div>
);

// --- Image Generation Tool ---
const ImageGeneratorTool = ({ showMessage }) => {
    const [prompt, setPrompt] = useState('');
    const [imageUrl, setImageUrl] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const handleGenerateImage = async () => {
        if (!prompt.trim()) {
            showMessage("Please enter a description for the image.");
            return;
        }

        setIsLoading(true);
        setImageUrl(''); // Clear previous image

        // Regex to find and extract text enclosed in {{TEXT: ...}}
        const textToOverlayRegex = /\{\{TEXT:\s*(.*?)\s*\}\}/i;
        const match = prompt.match(textToOverlayRegex);
        let textToOverlay = '';
        let imageGenerationPrompt = prompt.trim();

        if (match && match[1]) {
            textToOverlay = match[1];
            // Remove the text overlay part from the prompt sent to the image model
            imageGenerationPrompt = prompt.replace(textToOverlayRegex, '').trim();
        }

        // If the remaining prompt is empty after extracting text, ensure there's a default or alert
        if (!imageGenerationPrompt) {
            showMessage("Please provide a visual description even if you're adding text.");
            setIsLoading(false);
            return;
        }

        try {
            const apiKey = ""; // API key will be provided at runtime by Canvas
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

            // Pass only the visual description to the image generation model
            const payload = { instances: { prompt: imageGenerationPrompt }, parameters: { "sampleCount": 1 } };
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Image Generation API error: ${response.status} ${response.statusText} - ${errorMessage}. Please check your API key and its permissions for Imagen-3.0-generate-002.`);
            }

            const result = await response.json();
            if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
                let generatedImageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                
                // First, draw the user-specified text if any
                generatedImageUrl = await drawTextOnBase64Image(generatedImageUrl, textToOverlay, showMessage);

                // Then, add the Nithin AI watermark
                generatedImageUrl = await addWatermarkToImage(generatedImageUrl, "NITHIN AI IMGEN", showMessage);

                setImageUrl(generatedImageUrl);
                showMessage("Image generated successfully!");
            } else {
                showMessage("Failed to generate image. Unexpected response from API.");
                console.warn('Image generation API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error generating image:', error);
            showMessage(`Image generation failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    const handleDownloadImage = () => {
        if (imageUrl) {
            const link = document.createElement('a');
            link.href = imageUrl;
            // Changed filename to start with NITHIN_IMGEN
            link.download = `NITHIN_IMGEN_generated_image.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showMessage("Image download started!");
        } else {
            showMessage("No image to download.");
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">Image Generation</h2>
            <p className="text-gray-600 mb-6">Enter a description and let AI create an image for you. Use <code className="bg-gray-200 p-1 rounded">{'{{TEXT: Your text}}'}</code> to add text on image.</p>
            <div className="flex flex-col items-center">
                <input
                    type="text"
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4"
                    placeholder="Describe the image (e.g., 'A cat in space {{TEXT: Meow!}}')"
                    value={prompt}
                    onChange={(e) => setPrompt(e.target.value)}
                    disabled={isLoading}
                />
                <button
                    onClick={handleGenerateImage}
                    className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !prompt.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16l4.879-4.879m0 0a3 3 0 104.243 4.243L19 19m-4.243-4.243L10.879 10.879m0 0A3 3 0 106.636 6.636L1 1m4.243 4.243L16 16"></path></svg>
                    )}
                    {isLoading ? 'Generating...' : 'Generate Image'}
                </button>
                {imageUrl && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Generated Image:</h3>
                        <img src={imageUrl} alt="Generated AI Image" className="w-full h-auto rounded-lg shadow-md border border-gray-200" />
                        <div className="flex justify-end mt-4">
                            <CopyToClipboardButton textToCopy={imageUrl} showMessage={showMessage} />
                            <button
                                onClick={handleDownloadImage}
                                className="ml-2 px-3 py-1 bg-green-500 text-white rounded-md hover:bg-green-600 transition duration-200 text-sm flex items-center justify-center"
                                title="Download image"
                            >
                                <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                <span className="hidden sm:inline">Download</span>
                            </button>
                        </div>
                        <FeedbackButtons showMessage={showMessage} outputId="imageGenOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};


// --- Text Summarizer Tool ---
const TextSummarizerTool = ({ showMessage }) => {
    const [inputText, setInputText] = useState('');
    const [summary, setSummary] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const handleSummarize = async () => {
        if (!inputText.trim()) {
            showMessage("Please enter text to summarize.");
            return;
        }

        setIsLoading(true);
        setSummary(''); // Clear previous summary

        try {
            const apiKey = ""; // API key will be provided at runtime by Canvas
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const prompt = `Summarize the following text concisely. Keep the summary under 150 words and focus on the main points:\n\n${inputText}`;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}. Please check your API key and its permissions for gemini-2.0-flash.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                setSummary(result.candidates[0].content.parts[0].text);
                showMessage("Text summarized successfully!");
            } else {
                showMessage("Failed to summarize text. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error summarizing text:', error);
            showMessage(`Summarization failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">Text Summarizer</h2>
            <p className="text-gray-600 mb-6">Paste a long text and get a concise summary.</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="8"
                    placeholder="Paste your text here..."
                    value={inputText}
                    onChange={(e) => setInputText(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <button
                    onClick={handleSummarize}
                    className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !inputText.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                    )}
                    {isLoading ? 'Summarizing...' : 'Summarize Text'}
                </button>
                {summary && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Summary:</h3>
                        <p className="text-gray-800 text-left whitespace-pre-wrap">{summary}</p>
                        <CopyToClipboardButton textToCopy={summary} showMessage={showMessage} />
                        <FeedbackButtons showMessage={showMessage} outputId="summarizerOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- AI Content Studio Tool (New) ---
const AIContentStudioTool = ({ showMessage, elevenLabsApiKey }) => {
    const [prompt, setPrompt] = useState('');
    const [generatedContent, setGeneratedContent] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const { speak, stopSpeaking, isSpeaking } = useSpeechSynthesis(elevenLabsApiKey, showMessage);
    const { startListening, stopListening, isListening, interimTranscript } = useSpeechRecognition(
        (finalTranscript) => {
            setPrompt((prevPrompt) => (prevPrompt ? prevPrompt + ' ' : '') + finalTranscript);
        },
        (error) => {
            console.error("STT Error:", error);
            // showMessage(error); // showMessage is already called by the hook for common errors
        },
        showMessage
    );

    useEffect(() => {
        if (isListening && interimTranscript) {
            // Update the prompt immediately as interim results come in
            setPrompt((prev) => {
                // Keep only the last full input + current interim
                const lastFullInput = prev.split(' ').slice(0, prev.split(' ').length - interimTranscript.split(' ').length).join(' ');
                return lastFullInput ? lastFullInput + ' ' + interimTranscript : interimTranscript;
            });
        }
    }, [interimTranscript, isListening]);


    const handleGenerateContent = async () => {
        if (!prompt.trim()) {
            showMessage("Please enter a prompt to generate content.");
            return;
        }

        setIsLoading(true);
        setGeneratedContent(''); // Clear previous content
        stopSpeaking(); // Stop any ongoing speech

        try {
            const apiKey = ""; // API key will be provided at runtime by Canvas
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            // Modified prompt to include grammar and spelling instructions
            const fullPrompt = `Generate content based on the following idea. Ensure the output is grammatically correct, has proper punctuation, and is free of spelling mistakes:\n\n${prompt}`;
            const chatHistory = [{ role: "user", parts: [{ text: fullPrompt }] }];
            const payload = { contents: chatHistory };

            console.log("Content Studio API URL:", apiUrl);
            console.log("Content Studio Payload:", payload);

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}. Please check your API key and its permissions for gemini-2.0-flash.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                setGeneratedContent(result.candidates[0].content.parts[0].text);
                showMessage("Content generated successfully!");
            } else {
                showMessage("Failed to generate content. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error generating content:', error);
            showMessage(`Content generation failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">AI Content Studio</h2>
            <p className="text-gray-600 mb-6">Generate creative text content using voice or text input.</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="6"
                    placeholder="Enter your content idea or speak into the microphone..."
                    value={prompt}
                    onChange={(e) => setPrompt(e.target.value)}
                    disabled={isLoading || isListening}
                ></textarea>
                <div className="flex gap-4 mb-4">
                    <button
                        onClick={isListening ? stopListening : startListening}
                        className={`px-4 py-2 rounded-lg transition duration-300 shadow-md flex items-center justify-center ${
                            isListening ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-purple-600 hover:bg-purple-700 text-white'
                        }`}
                        disabled={isLoading}
                    >
                        {isListening ? (
                            <>
                                <svg className="animate-pulse w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v3a3 3 0 01-3 3z"></path></svg>
                                Stop Listening
                            </>
                        ) : (
                            <>
                                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v3a3 3 0 01-3 3z"></path></svg>
                                Start Voice Input
                            </>
                        )}
                    </button>
                    <button
                        onClick={handleGenerateContent}
                        className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                        disabled={isLoading || !prompt.trim()}
                    >
                        {isLoading ? (
                            <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                            <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                        )}
                        {isLoading ? 'Generating...' : 'Generate Content'}
                    </button>
                </div>
                {generatedContent && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Generated Content:</h3>
                        <p className="text-gray-800 text-left whitespace-pre-wrap">{generatedContent}</p>
                        <div className="flex justify-end mt-4">
                            <CopyToClipboardButton textToCopy={generatedContent} showMessage={showMessage} />
                            <button
                                onClick={isSpeaking ? stopSpeaking : () => speak(generatedContent)}
                                className={`ml-2 px-3 py-1 rounded-md transition duration-200 text-sm flex items-center justify-center ${
                                    isSpeaking ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-700'
                                }`}
                                title={isSpeaking ? "Stop speaking" : "Listen to content"}
                                disabled={!generatedContent || isLoading}
                            >
                                {isSpeaking ? (
                                    <>
                                        <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                        Stop
                                    </>
                                ) : (
                                    <>
                                        <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.536 8.464a5 5 0 010 7.072m2.121-9.193a8 8 0 010 11.314m-1.06-1.06a3.5 3.5 0 010 4.95zm-3.182-3.182a.5.5 0 00-.707 0l-5 5a.5.5 0 00.354.854H9.5a.5.5 0 00.354-.854L6.172 12.5l2.646-2.646a.5.5 0 00.354-.854H14.5a.5.5 0 00.354-.854L11.172 6.5l2.646-2.646a.5.5 0 00.354-.854H19.5a.5.5 0 00.354-.854L16.172 0.5"></path></svg>
                                        Speak
                                    </>
                                )}
                            </button>
                        </div>
                        <FeedbackButtons showMessage={showMessage} outputId="contentStudioOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Code Generator Tool (NEW) ---
const CodeGeneratorTool = ({ showMessage }) => {
    const [codePrompt, setCodePrompt] = useState('');
    const [codeLanguage, setCodeLanguage] = useState('html');
    const [generatedCode, setGeneratedCode] = useState('');
    const [isLoading, setIsLoading] = useState(false);
    const [previewHtml, setPreviewHtml] = useState('');

    const handleGenerateCode = async () => {
        if (!codePrompt.trim()) {
            showMessage("Please enter a description for the code.");
            return;
        }

        setIsLoading(true);
        setGeneratedCode('');
        setPreviewHtml('');

        try {
            const apiKey = ""; // API key will be provided at runtime by Canvas
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const prompt = `Generate ${codeLanguage} code for the following description. ONLY return the code block, no explanations, no conversational text, no markdown backticks. If it's HTML, include full HTML structure (doctype, html, head, body) and inline CSS and JavaScript if needed, ensuring it's responsive with Tailwind CSS classes. If it's React, provide a single, self-contained App functional component. If it's Python, provide a complete script.

Description: ${codePrompt}`;

            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            console.log("Code Generator API URL:", apiUrl);
            console.log("Code Generator Payload:", payload);

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}. Please check your API key and its permissions for gemini-2.0-flash.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                let code = result.candidates[0].content.parts[0].text;
                // Remove potential markdown backticks or extra formatting
                code = code.replace(/```(?:html|javascript|python|react)?\n?/gi, '').replace(/```$/, '').trim();
                
                setGeneratedCode(code);
                showMessage("Code generated successfully!");

                // Prepare for preview if applicable
                if (codeLanguage === 'html' || codeLanguage === 'javascript' || codeLanguage === 'css') {
                    // For JS/CSS, wrap it in a basic HTML structure for preview
                    let htmlContent = code;
                    if (codeLanguage === 'javascript') {
                        htmlContent = `<html lang="en"><head><title>JS Preview</title><script src="https://cdn.tailwindcss.com"></script></head><body class="p-4"><script>${code}</script></body></html>`;
                    } else if (codeLanguage === 'css') {
                        htmlContent = `<html lang="en"><head><title>CSS Preview</title><script src="https://cdn.tailwindcss.com"></script><style>${code}</style></head><body class="p-4"><h1>CSS Preview</h1><p>This is a paragraph styled by the generated CSS.</p><button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Example Button</button></body></html>`;
                    } else { // HTML
                        // Ensure Tailwind CSS is included if not already
                        if (!htmlContent.includes('cdn.tailwindcss.com')) {
                            const headEndIndex = htmlContent.indexOf('</head>');
                            if (headEndIndex !== -1) {
                                htmlContent = htmlContent.substring(0, headEndIndex) + '<script src="https://cdn.tailwindcss.com"></script>' + htmlContent.substring(headEndIndex);
                            }
                        }
                    }
                    setPreviewHtml(htmlContent);
                } else if (codeLanguage === 'react') {
                    // For React, we cannot execute it directly in an iframe easily without a build step.
                    // Just instruct the user for manual integration.
                    setPreviewHtml('<p class="text-red-500">Live interactive preview for React code is not directly supported within this sandbox. Please copy the code and run it in a React development environment.</p>');
                }

            } else {
                showMessage("Failed to generate code. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error generating code:', error);
            showMessage(`Code generation failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">Code Generator</h2>
            <p className="text-gray-600 mb-6">Describe the code you need, and choose a programming language.</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="4"
                    placeholder="e.g., 'A simple HTML form with input fields for name and email, styled with Tailwind CSS.'"
                    value={codePrompt}
                    onChange={(e) => setCodePrompt(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <div className="flex gap-4 mb-4 w-full max-w-lg">
                    <label htmlFor="code-language" className="sr-only">Choose Language:</label>
                    <select
                        id="code-language"
                        value={codeLanguage}
                        onChange={(e) => setCodeLanguage(e.target.value)}
                        className="p-3 border border-gray-300 rounded-lg flex-grow"
                        disabled={isLoading}
                    >
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                        <option value="javascript">JavaScript</option>
                        <option value="react">React</option>
                        <option value="python">Python</option>
                    </select>
                    <button
                        onClick={handleGenerateCode}
                        className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                        disabled={isLoading || !codePrompt.trim()}
                    >
                        {isLoading ? (
                            <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                            <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                        )}
                        {isLoading ? 'Generating...' : 'Generate Code'}
                    </button>
                </div>

                {generatedCode && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-4xl w-full text-left">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Generated Code ({codeLanguage}):</h3>
                        <pre className="bg-gray-800 text-white p-4 rounded-md overflow-x-auto text-sm">
                            <code>{generatedCode}</code>
                        </pre>
                        <div className="flex justify-end mt-4">
                            <CopyToClipboardButton textToCopy={generatedCode} showMessage={showMessage} />
                        </div>

                        {(codeLanguage === 'html' || codeLanguage === 'javascript' || codeLanguage === 'css' || codeLanguage === 'react') && (
                            <div className="mt-8">
                                <h3 className="text-xl font-semibold text-gray-700 mb-4">Live Preview:</h3>
                                <div className="bg-white p-4 rounded-lg shadow-md border border-gray-200 w-full h-80 overflow-auto">
                                    {codeLanguage === 'html' || codeLanguage === 'javascript' || codeLanguage === 'css' ? (
                                        <iframe
                                            title="Code Preview"
                                            srcDoc={previewHtml}
                                            sandbox="allow-scripts allow-same-origin allow-popups" // Added allow-popups for potential dynamic content
                                            className="w-full h-full border-none"
                                        />
                                    ) : (
                                        <div dangerouslySetInnerHTML={{ __html: previewHtml }} />
                                    )}
                                </div>
                            </div>
                        )}
                        <FeedbackButtons showMessage={showMessage} outputId="codeGenOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Creative Writing Assistant Tool (New LLM Feature) ---
const CreativeWritingTool = ({ showMessage }) => {
    const [prompt, setPrompt] = useState('');
    const [generatedText, setGeneratedText] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const handleGenerateWriting = async () => {
        if (!prompt.trim()) {
            showMessage("Please enter a prompt for creative writing.");
            return;
        }

        setIsLoading(true);
        setGeneratedText('');

        try {
            const apiKey = ""; // API key will be provided at runtime by Canvas
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const fullPrompt = `Generate a creative text based on the following idea. It can be a story, poem, script, or just brainstorming ideas. Ensure it's engaging and well-written:\n\n${prompt}`;
            const chatHistory = [{ role: "user", parts: [{ text: fullPrompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}. Please check your API key and its permissions for gemini-2.0-flash.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                setGeneratedText(result.candidates[0].content.parts[0].text);
                showMessage("Creative writing generated successfully!");
            } else {
                showMessage("Failed to generate creative writing. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error generating creative writing:', error);
            showMessage(`Creative writing generation failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">‚ú® Creative Writing Assistant ‚ú®</h2>
            <p className="text-gray-600 mb-6">Unleash your imagination! Get help writing stories, poems, or brainstorm ideas.</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="6"
                    placeholder="E.g., 'A short story about a time-traveling detective in ancient Rome', 'A poem about autumn leaves', 'Brainstorm ideas for a sci-fi novel about sentient AI'."
                    value={prompt}
                    onChange={(e) => setPrompt(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <button
                    onClick={handleGenerateWriting}
                    className="px-6 py-3 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !prompt.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    )}
                    {isLoading ? 'Generating...' : 'Generate Writing'}
                </button>
                {generatedText && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Generated Content:</h3>
                        <p className="text-gray-800 text-left whitespace-pre-wrap">{generatedText}</p>
                        <CopyToClipboardButton textToCopy={generatedText} showMessage={showMessage} />
                        <FeedbackButtons showMessage={showMessage} outputId="creativeWritingOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Meal Planner Tool (New LLM Feature) ---
const MealPlannerTool = ({ showMessage }) => {
    const [ingredients, setIngredients] = useState('');
    const [mealPlan, setMealPlan] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const handleGenerateMealPlan = async () => {
        if (!ingredients.trim()) {
            showMessage("Please enter some ingredients or meal preferences.");
            return;
        }

        setIsLoading(true);
        setMealPlan('');

        try {
            const apiKey = ""; // API key will be provided at runtime by Canvas
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const prompt = `Generate a meal plan or recipe suggestions based on the following ingredients/preferences. Provide a clear, easy-to-follow recipe format, including ingredients list, instructions, and serving size. If ingredients are provided, prioritize them. If preferences are provided, suggest a suitable meal:\n\nIngredients/Preferences: ${ingredients}`;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}. Please check your API key and its permissions for gemini-2.0-flash.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                setMealPlan(result.candidates[0].content.parts[0].text);
                showMessage("Meal plan generated successfully!");
            } else {
                showMessage("Failed to generate meal plan. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error generating meal plan:', error);
            showMessage(`Meal plan generation failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">‚ú® Meal Planner ‚ú®</h2>
            <p className="text-gray-600 mb-6">Input ingredients you have, or describe your meal preferences, and get tailored recipes.</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="6"
                    placeholder="E.g., 'chicken, rice, broccoli', 'quick dinner ideas for two', 'vegetarian breakfast for one'."
                    value={ingredients}
                    onChange={(e) => setIngredients(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <button
                    onClick={handleGenerateMealPlan}
                    className="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !ingredients.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v3a3 3 0 01-3 3z"></path></svg>
                    )}
                    {isLoading ? 'Generating...' : 'Generate Meal Plan'}
                </button>
                {mealPlan && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Generated Meal Plan/Recipe:</h3>
                        <p className="text-gray-800 text-left whitespace-pre-wrap">{mealPlan}</p>
                        <CopyToClipboardButton textToCopy={mealPlan} showMessage={showMessage} />
                        <FeedbackButtons showMessage={showMessage} outputId="mealPlanOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Language Translator Tool (New LLM Feature) ---
const LanguageTranslatorTool = ({ showMessage }) => {
    const [inputText, setInputText] = useState('');
    const [sourceLang, setSourceLang] = useState('auto');
    const [targetLang, setTargetLang] = useState('en');
    const [translatedText, setTranslatedText] = useState('');
    const [isLoading, setIsLoading] = useState(false);
    const [searchTerm, setSearchTerm] = useState('');

    // Extensive list of languages - Removed duplicates.
    const allLanguages = [
        { value: 'auto', label: 'Detect Language' },
        { value: 'en', label: 'English' },
        { value: 'hi', label: 'Hindi' },
        { value: 'es', label: 'Spanish' },
        { value: 'fr', label: 'French' },
        { value: 'de', label: 'German' },
        { value: 'zh', label: 'Chinese (Simplified)' },
        { value: 'ja', label: 'Japanese' },
        { value: 'ko', label: 'Korean' },
        { value: 'ru', label: 'Russian' },
        { value: 'ar', label: 'Arabic' },
        { value: 'pt', label: 'Portuguese' },
        { value: 'it', label: 'Italian' },
        { value: 'bn', label: 'Bengali' },
        { value: 'nl', label: 'Dutch' },
        { value: 'sv', label: 'Swedish' },
        { value: 'no', label: 'Norwegian' },
        { value: 'da', label: 'Danish' },
        { value: 'fi', label: 'Finnish' },
        { value: 'el', label: 'Greek' },
        { value: 'he', label: 'Hebrew' }, 
        { value: 'pl', label: 'Polish' },
        { value: 'tr', label: 'Turkish' },
        { value: 'uk', label: 'Ukrainian' },
        { value: 'vi', label: 'Vietnamese' },
        { value: 'th', label: 'Thai' },
        { value: 'id', label: 'Indonesian' },
        { value: 'ms', label: 'Malay' },
        { value: 'fa', label: 'Persian' }, 
        { value: 'ur', label: 'Urdu' },
        { value: 'sw', label: 'Swahili' },
        { value: 'am', label: 'Amharic' },
        { value: 'yo', label: 'Yoruba' },
        { value: 'ig', label: 'Igbo' },
        { value: 'ha', label: 'Hausa' },
        { value: 'zu', label: 'Zulu' }, 
        { value: 'xh', label: 'Xhosa' },
        { value: 'af', label: 'Afrikaans' },
        { value: 'sq', label: 'Albanian' },
        { value: 'hy', label: 'Armenian' },
        { value: 'az', label: 'Azerbaijani' },
        { value: 'eu', label: 'Basque' },
        { value: 'be', label: 'Belarusian' },
        { value: 'bs', label: 'Bosnian' },
        { value: 'bg', label: 'Bulgarian' },
        { value: 'ca', label: 'Catalan' },
        { value: 'ceb', label: 'Cebuano' },
        { value: 'ny', label: 'Chichewa' },
        { value: 'hr', label: 'Croatian' },
        { value: 'cs', label: 'Czech' },
        { value: 'et', label: 'Estonian' },
        { value: 'tl', label: 'Filipino' },
        { value: 'gl', label: 'Galician' },
        { value: 'ka', label: 'Georgian' },
        { value: 'gu', label: 'Gujarati' },
        { value: 'ht', label: 'Haitian Creole' },
        { value: 'hu', label: 'Hungarian' },
        { value: 'is', label: 'Icelandic' },
        { value: 'ga', label: 'Irish' },
        { value: 'jw', label: 'Javanese' },
        { value: 'kn', label: 'Kannada' },
        { value: 'kk', label: 'Kazakh' },
        { value: 'km', label: 'Khmer' },
        { value: 'rw', label: 'Kinyarwanda' },
        { value: 'ky', label: 'Kyrgyz' },
        { value: 'lo', label: 'Lao' },
        { value: 'la', label: 'Latin' },
        { value: 'lv', label: 'Latvian' },
        { value: 'lt', label: 'Lithuanian' },
        { value: 'lb', label: 'Luxembourgish' },
        { value: 'mk', label: 'Macedonian' },
        { value: 'mg', label: 'Malagasy' },
        { value: 'ml', label: 'Malayalam' },
        { value: 'mt', label: 'Maltese' },
        { value: 'mi', label: 'Maori' },
        { value: 'mr', label: 'Marathi' },
        { value: 'mn', label: 'Mongolian' },
        { value: 'my', label: 'Myanmar (Burmese)' },
        { value: 'ne', label: 'Nepali' },
        { value: 'or', label: 'Odia (Oriya)' },
        { value: 'ps', label: 'Pashto' },
        { value: 'pa', label: 'Punjabi' },
        { value: 'ro', label: 'Romanian' },
        { value: 'sm', label: 'Samoan' },
        { value: 'gd', label: 'Scots Gaelic' },
        { value: 'sr', label: 'Serbian' },
        { value: 'st', label: 'Sesotho' },
        { value: 'sn', label: 'Shona' },
        { value: 'sd', label: 'Sindhi' },
        { value: 'si', label: 'Sinhala' },
        { value: 'sk', label: 'Slovak' },
        { value: 'sl', label: 'Slovenian' },
        { value: 'so', label: 'Somali' },
        { value: 'su', label: 'Sundanese' },
        { value: 'tg', label: 'Tajik' },
        { value: 'ta', label: 'Tamil' },
        { value: 'tt', label: 'Tatar' },
        { value: 'te', label: 'Telugu' },
        { value: 'ug', label: 'Uyghur' },
        { value: 'uz', label: 'Uzbek' },
        { value: 'cy', label: 'Welsh' },
        { value: 'fy', label: 'Western Frisian' },
        { value: 'yi', label: 'Yiddish' },
    ];

    const filteredSourceLanguages = allLanguages.filter(lang =>
        lang.label.toLowerCase().includes(searchTerm.toLowerCase())
    );

    const filteredTargetLanguages = allLanguages.filter(lang =>
        lang.value !== 'auto' && lang.label.toLowerCase().includes(searchTerm.toLowerCase())
    );

    const handleTranslate = async () => {
        if (!inputText.trim()) {
            showMessage("Please enter text to translate.");
            return;
        }
        if (sourceLang === targetLang && sourceLang !== 'auto') {
            showMessage("Source and target languages cannot be the same (unless source is 'Detect Language').");
            return;
        }

        setIsLoading(true);
        setTranslatedText('');

        try {
            const apiKey = ""; // API key will be provided at runtime by Canvas
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const prompt = `Translate the following text from ${sourceLang === 'auto' ? 'an automatically detected language' : allLanguages.find(l => l.value === sourceLang)?.label || sourceLang} to ${allLanguages.find(l => l.value === targetLang)?.label || targetLang}. Only return the translated text, no additional conversational text or explanations:\n\nText to translate: "${inputText}"`;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}. Please check your API key and its permissions for gemini-2.0-flash.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                setTranslatedText(result.candidates[0].content.parts[0].text.trim());
                showMessage("Text translated successfully!");
            } else {
                showMessage("Failed to translate text. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error translating text:', error);
            showMessage(`Translation failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">‚ú® Language Translator ‚ú®</h2>
            <p className="text-gray-600 mb-6">Translate text between various languages powered by AI.</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="5"
                    placeholder="Enter text to translate..."
                    value={inputText}
                    onChange={(e) => setInputText(e.target.value)}
                    disabled={isLoading}
                ></textarea>

                <div className="flex flex-col sm:flex-row gap-4 mb-4 w-full max-w-lg">
                    <div className="flex-1">
                        <label htmlFor="source-lang" className="block text-left text-gray-700 text-sm font-medium mb-1">Source Language:</label>
                        <div className="relative">
                            <input
                                type="text"
                                placeholder="Search source language..."
                                className="w-full p-3 border border-gray-300 rounded-lg mb-2"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                disabled={isLoading}
                            />
                            <select
                                id="source-lang"
                                value={sourceLang}
                                onChange={(e) => setSourceLang(e.target.value)}
                                className="p-3 border border-gray-300 rounded-lg w-full custom-select-arrow" // Add custom-select-arrow for styling
                                disabled={isLoading}
                            >
                                {filteredSourceLanguages.map(lang => (
                                    <option key={lang.value} value={lang.value}>{lang.label}</option>
                                ))}
                            </select>
                        </div>
                    </div>
                    <div className="flex-1">
                        <label htmlFor="target-lang" className="block text-left text-gray-700 text-sm font-medium mb-1">Target Language:</label>
                        <div className="relative">
                            <input
                                type="text"
                                placeholder="Search target language..."
                                className="w-full p-3 border border-gray-300 rounded-lg mb-2"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                disabled={isLoading}
                            />
                            <select
                                id="target-lang"
                                value={targetLang}
                                onChange={(e) => setTargetLang(e.target.value)}
                                className="p-3 border border-gray-300 rounded-lg w-full custom-select-arrow" // Add custom-select-arrow for styling
                                disabled={isLoading}
                            >
                                {filteredTargetLanguages.map(lang => (
                                    <option key={lang.value} value={lang.value}>{lang.label}</option>
                                ))}
                            </select>
                        </div>
                    </div>
                </div>

                <button
                    onClick={handleTranslate}
                    className="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !inputText.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    )}
                    {isLoading ? 'Translating...' : 'Translate Text'}
                </button>
                {translatedText && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Translated Text:</h3>
                        <p className="text-gray-800 text-left whitespace-pre-wrap">{translatedText}</p>
                        <CopyToClipboardButton textToCopy={translatedText} showMessage={showMessage} />
                        <FeedbackButtons showMessage={showMessage} outputId="translatorOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Sentiment Analyzer Tool (New) ---
const SentimentAnalyzerTool = ({ showMessage }) => {
    const [inputText, setInputText] = useState('');
    const [sentiment, setSentiment] = useState(null); // 'positive', 'negative', 'neutral', or null
    const [isLoading, setIsLoading] = useState(false);

    const getSentimentColor = (sentiment) => {
        switch (sentiment) {
            case 'positive': return 'text-green-700 bg-green-100';
            case 'negative': return 'text-red-700 bg-red-100';
            case 'neutral': return 'text-blue-700 bg-blue-100';
            default: return 'text-gray-700 bg-gray-100';
        }
    };

    const handleAnalyzeSentiment = async () => {
        if (!inputText.trim()) {
            showMessage("Please enter text to analyze sentiment.");
            return;
        }

        setIsLoading(true);
        setSentiment(null);

        try {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const prompt = `Analyze the sentiment of the following text. Respond with only one word: 'positive', 'negative', or 'neutral'.\n\nText: "${inputText}"`;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const aiSentiment = result.candidates[0].content.parts[0].text.toLowerCase().trim();
                if (['positive', 'negative', 'neutral'].includes(aiSentiment)) {
                    setSentiment(aiSentiment);
                    showMessage(`Sentiment analyzed: ${aiSentiment}`);
                } else {
                    setSentiment('unknown');
                    showMessage("Could not determine sentiment. AI response was unexpected.");
                    console.warn("Unexpected sentiment response:", aiSentiment);
                }
            } else {
                showMessage("Failed to analyze sentiment. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error analyzing sentiment:', error);
            showMessage(`Sentiment analysis failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">Sentiment Analyzer</h2>
            <p className="text-gray-600 mb-6">Enter text to determine its emotional tone (positive, negative, or neutral).</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="5"
                    placeholder="Enter text to analyze sentiment..."
                    value={inputText}
                    onChange={(e) => setInputText(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <button
                    onClick={handleAnalyzeSentiment}
                    className="px-6 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !inputText.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 19V6l12-3v13M3 17l6 3v-10l-6-3V17z"></path></svg>
                    )}
                    {isLoading ? 'Analyzing...' : 'Analyze Sentiment'}
                </button>
                {sentiment && (
                    <div className={`mt-8 p-4 rounded-lg shadow-inner max-w-lg w-full ${getSentimentColor(sentiment)}`}>
                        <h3 className="text-xl font-semibold mb-2">Sentiment:</h3>
                        <p className="capitalize text-2xl font-bold">{sentiment}</p>
                        <FeedbackButtons showMessage={showMessage} outputId="sentimentOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Keyword Extractor Tool (New) ---
const KeywordExtractorTool = ({ showMessage }) => {
    const [inputText, setInputText] = useState('');
    const [keywords, setKeywords] = useState([]);
    const [isLoading, setIsLoading] = useState(false);

    const handleExtractKeywords = async () => {
        if (!inputText.trim()) {
            showMessage("Please enter text to extract keywords from.");
            return;
        }

        setIsLoading(true);
        setKeywords([]);

        try {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const prompt = `Extract the most important keywords from the following text. Return them as a comma-separated list. Only return the keywords, nothing else.\n\nText: "${inputText}"`;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                const extractedText = result.candidates[0].content.parts[0].text;
                const parsedKeywords = extractedText.split(',').map(kw => kw.trim()).filter(kw => kw !== '');
                setKeywords(parsedKeywords);
                showMessage("Keywords extracted successfully!");
            } else {
                showMessage("Failed to extract keywords. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error extracting keywords:', error);
            showMessage(`Keyword extraction failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">Keyword Extractor</h2>
            <p className="text-gray-600 mb-6">Paste text to identify key terms and topics.</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="5"
                    placeholder="Enter text to extract keywords from..."
                    value={inputText}
                    onChange={(e) => setInputText(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <button
                    onClick={handleExtractKeywords}
                    className="px-6 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !inputText.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 8h10M7 12h10M7 16h10M9 4h6a2 2 0 012 2v12a2 2 0 01-2 2H9a2 2 0 01-2-2V6a2 2 0 012-2z"></path></svg>
                    )}
                    {isLoading ? 'Extracting...' : 'Extract Keywords'}
                </button>
                {keywords.length > 0 && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full text-left">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Extracted Keywords:</h3>
                        <div className="flex flex-wrap gap-2">
                            {keywords.map((kw, index) => (
                                <span key={index} className="bg-blue-200 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                    {kw}
                                </span>
                            ))}
                        </div>
                        <CopyToClipboardButton textToCopy={keywords.join(', ')} showMessage={showMessage} />
                        <FeedbackButtons showMessage={showMessage} outputId="keywordsOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Question Answering Bot Tool (New) ---
const QABotTool = ({ showMessage }) => {
    const [contextText, setContextText] = useState('');
    const [question, setQuestion] = useState('');
    const [answer, setAnswer] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const handleAnswerQuestion = async () => {
        if (!question.trim()) {
            showMessage("Please enter a question.");
            return;
        }
        if (!contextText.trim()) {
            showMessage("Please provide some context text or the AI will try to answer from general knowledge.");
        }

        setIsLoading(true);
        setAnswer('');

        try {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            let prompt;
            if (contextText.trim()) {
                prompt = `Given the following text, answer the question. If the answer is not in the text, state that you don't know.\n\nContext: "${contextText}"\n\nQuestion: "${question}"\n\nAnswer:`;
            } else {
                prompt = `Answer the following question from your general knowledge:\n\nQuestion: "${question}"\n\nAnswer:`;
            }

            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                setAnswer(result.candidates[0].content.parts[0].text.trim());
                showMessage("Question answered successfully!");
            } else {
                showMessage("Failed to get an answer. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error answering question:', error);
            showMessage(`Failed to answer question: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">Question Answering Bot</h2>
            <p className="text-gray-600 mb-6">Ask questions based on a provided text or general knowledge.</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="5"
                    placeholder="Provide context text here (optional, for specific answers)..."
                    value={contextText}
                    onChange={(e) => setContextText(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <input
                    type="text"
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4"
                    placeholder="Enter your question here..."
                    value={question}
                    onChange={(e) => setQuestion(e.target.value)}
                    disabled={isLoading}
                />
                <button
                    onClick={handleAnswerQuestion}
                    className="px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !question.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8.228 9.247a3.75 3.75 0 100 5.506m-2.25 2.25a2 2 0 11-4 0m4 0a2 2 0 104 0m-4 0c0 2.25 1.5 3.5 3.75 3.5s3.75-1.25 3.75-3.5h0c0-2.25-1.5-3.5-3.75-3.5s-3.75 1.25-3.75 3.5z"></path></svg>
                    )}
                    {isLoading ? 'Answering...' : 'Get Answer'}
                </button>
                {answer && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full text-left">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Answer:</h3>
                        <p className="text-gray-800 whitespace-pre-wrap">{answer}</p>
                        <CopyToClipboardButton textToCopy={answer} showMessage={showMessage} />
                        <FeedbackButtons showMessage={showMessage} outputId="qaBotOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Grammar Corrector Tool (New) ---
const GrammarCorrectorTool = ({ showMessage }) => {
    const [inputText, setInputText] = useState('');
    const [correctedText, setCorrectedText] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const handleCorrectGrammar = async () => {
        if (!inputText.trim()) {
            showMessage("Please enter text to correct.");
            return;
        }

        setIsLoading(true);
        setCorrectedText('');

        try {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const prompt = `Correct the grammar, spelling, and punctuation of the following text. Only return the corrected text.\n\nText: "${inputText}"`;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                setCorrectedText(result.candidates[0].content.parts[0].text.trim());
                showMessage("Grammar corrected successfully!");
            } else {
                showMessage("Failed to correct grammar. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error correcting grammar:', error);
            showMessage(`Grammar correction failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">‚ú® Grammar Corrector ‚ú®</h2>
            <p className="text-gray-600 mb-6">Improve your writing by correcting grammar, spelling, and punctuation.</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="5"
                    placeholder="Enter text to correct..."
                    value={inputText}
                    onChange={(e) => setInputText(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <button
                    onClick={handleCorrectGrammar}
                    className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !inputText.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    )}
                    {isLoading ? 'Correcting...' : 'Correct Grammar'}
                </button>
                {correctedText && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full text-left">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Corrected Text:</h3>
                        <p className="text-gray-800 whitespace-pre-wrap">{correctedText}</p>
                        <CopyToClipboardButton textToCopy={correctedText} showMessage={showMessage} />
                        <FeedbackButtons showMessage={showMessage} outputId="grammarOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Code Debugger Tool (New - Placeholder) ---
const CodeDebuggerTool = ({ showMessage }) => {
    const [code, setCode] = useState('');
    const [language, setLanguage] = useState('javascript');
    const [debugOutput, setDebugOutput] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const handleDebugCode = async () => {
        if (!code.trim()) {
            showMessage("Please enter code to debug.");
            return;
        }

        setIsLoading(true);
        setDebugOutput('');

        try {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            // This is a simplified prompt for a placeholder.
            // A real debugger would require more sophisticated prompting
            // and potentially tool use (e.g., executing code in a sandbox).
            const prompt = `Act as a code debugger. Analyze the following ${language} code for potential errors, bugs, or improvements. Provide suggestions for fixing any issues found and explain why. If no errors, suggest improvements.

Code:
\`\`\`${language}
${code}
\`\`\``;
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                setDebugOutput(result.candidates[0].content.parts[0].text.trim());
                showMessage("Debugging analysis complete!");
            } else {
                showMessage("Failed to debug code. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error debugging code:', error);
            showMessage(`Code debugging failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">‚ú® Code Debugger ‚ú®</h2>
            <p className="text-gray-600 mb-6">Paste your code and let AI help you find and fix bugs (placeholder).</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="8"
                    placeholder="Paste your code here..."
                    value={code}
                    onChange={(e) => setCode(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <div className="flex gap-4 mb-4 w-full max-w-lg">
                    <label htmlFor="debug-language" className="sr-only">Choose Language:</label>
                    <select
                        id="debug-language"
                        value={language}
                        onChange={(e) => setLanguage(e.target.value)}
                        className="p-3 border border-gray-300 rounded-lg flex-grow"
                        disabled={isLoading}
                    >
                        <option value="javascript">JavaScript</option>
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="cpp">C++</option>
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                    </select>
                    <button
                        onClick={handleDebugCode}
                        className="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                        disabled={isLoading || !code.trim()}
                    >
                        {isLoading ? (
                            <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        ) : (
                            <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                        )}
                        {isLoading ? 'Debugging...' : 'Debug Code'}
                    </button>
                </div>
                {debugOutput && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full text-left">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Debug Output:</h3>
                        <pre className="bg-gray-800 text-white p-4 rounded-md overflow-x-auto text-sm">
                            <code>{debugOutput}</code>
                        </pre>
                        <CopyToClipboardButton textToCopy={debugOutput} showMessage={showMessage} />
                        <FeedbackButtons showMessage={showMessage} outputId="debuggerOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};

// --- Recipe Adjuster Tool (New - Placeholder) ---
const RecipeAdjusterTool = ({ showMessage }) => {
    const [originalRecipe, setOriginalRecipe] = useState('');
    const [desiredServings, setDesiredServings] = useState('');
    const [dietaryPreference, setDietaryPreference] = useState('');
    const [adjustedRecipe, setAdjustedRecipe] = useState('');
    const [isLoading, setIsLoading] = useState(false);

    const handleAdjustRecipe = async () => {
        if (!originalRecipe.trim()) {
            showMessage("Please enter the original recipe.");
            return;
        }

        setIsLoading(true);
        setAdjustedRecipe('');

        try {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            let prompt = `Adjust the following recipe`;
            if (desiredServings.trim()) {
                prompt += ` to serve ${desiredServings} people`;
            }
            if (dietaryPreference.trim()) {
                prompt += ` with a focus on making it ${dietaryPreference}`;
            }
            prompt += `. Provide the adjusted recipe clearly, including ingredients and instructions.\n\nOriginal Recipe:\n${originalRecipe}`;

            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const errorData = await response.json().catch(() => response.text());
                const errorMessage = typeof errorData === 'object' && errorData.error && errorData.error.message ? errorData.error.message : JSON.stringify(errorData);
                throw new Error(`Gemini API error: ${response.status} ${response.statusText} - ${errorMessage}.`);
            }

            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                setAdjustedRecipe(result.candidates[0].content.parts[0].text.trim());
                showMessage("Recipe adjusted successfully!");
            } else {
                showMessage("Failed to adjust recipe. Unexpected response from AI.");
                console.warn('Gemini API response structure unexpected:', result);
            }
        } catch (error) {
            console.error('Error adjusting recipe:', error);
            showMessage(`Recipe adjustment failed: ${error.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="text-center py-10">
            <h2 className="text-3xl font-bold text-gray-800 mb-4">‚ú® Recipe Adjuster ‚ú®</h2>
            <p className="text-gray-600 mb-6">Modify recipes based on servings or dietary preferences (placeholder).</p>
            <div className="flex flex-col items-center">
                <textarea
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4 resize-y"
                    rows="6"
                    placeholder="Paste the original recipe here..."
                    value={originalRecipe}
                    onChange={(e) => setOriginalRecipe(e.target.value)}
                    disabled={isLoading}
                ></textarea>
                <input
                    type="number"
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4"
                    placeholder="Desired servings (e.g., 4)"
                    value={desiredServings}
                    onChange={(e) => setDesiredServings(e.target.value)}
                    disabled={isLoading}
                />
                <input
                    type="text"
                    className="w-full max-w-lg p-3 border border-gray-300 rounded-lg mb-4"
                    placeholder="Dietary preference (e.g., 'vegetarian', 'gluten-free')"
                    value={dietaryPreference}
                    onChange={(e) => setDietaryPreference(e.target.value)}
                    disabled={isLoading}
                />
                <button
                    onClick={handleAdjustRecipe}
                    className="px-6 py-3 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                    disabled={isLoading || !originalRecipe.trim()}
                >
                    {isLoading ? (
                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    ) : (
                        <svg className="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path></svg>
                    )}
                    {isLoading ? 'Adjusting...' : 'Adjust Recipe'}
                </button>
                {adjustedRecipe && (
                    <div className="mt-8 p-4 bg-gray-100 rounded-lg shadow-inner max-w-lg w-full text-left">
                        <h3 className="text-xl font-semibold text-gray-700 mb-4">Adjusted Recipe:</h3>
                        <p className="text-gray-800 whitespace-pre-wrap">{adjustedRecipe}</p>
                        <CopyToClipboardButton textToCopy={adjustedRecipe} showMessage={showMessage} />
                        <FeedbackButtons showMessage={showMessage} outputId="recipeAdjusterOutput" />
                    </div>
                )}
            </div>
        </div>
    );
};


// --- Main App Component ---
export default function App() {
    const [currentPage, setCurrentPage] = useState('home');
    const [alertMessage, setAlertMessage] = useState(null);
    const [db, setDb] = useState(null);
    const [auth, setAuth] = useState(null);
    const [userId, setUserId] = useState(null); // To store current user ID
    const [isAuthReady, setIsAuthReady] = useState(false); // Track auth state

    const showMessage = useCallback((message) => {
        setAlertMessage(message);
    }, []);

    const closeMessage = useCallback(() => {
        setAlertMessage(null);
    }, []);

    // Firebase Initialization and Authentication
    useEffect(() => {
        if (Object.keys(firebaseConfig).length === 0) {
            console.error("Firebase config is missing. Please ensure __firebase_config is provided.");
            showMessage("Firebase is not configured. Data persistence and authentication features might not work.");
            setIsAuthReady(true); // Treat as ready if no config to avoid perpetual loading
            return;
        }

        try {
            const firebaseApp = initializeApp(firebaseConfig);
            const authInstance = getAuth(firebaseApp);
            const firestoreInstance = getFirestore(firebaseApp);

            setAuth(authInstance);
            setDb(firestoreInstance);

            const unsubscribe = onAuthStateChanged(authInstance, async (user) => {
                if (user) {
                    setUserId(user.uid);
                    console.log("Firebase Auth State Changed: User is signed in. UID:", user.uid);
                } else {
                    console.log("Firebase Auth State Changed: No user signed in. Attempting anonymous sign-in.");
                    if (initialAuthToken) {
                        try {
                            await signInWithCustomToken(authInstance, initialAuthToken);
                            setUserId(authInstance.currentUser?.uid);
                            console.log("Signed in with custom token.");
                        } catch (error) {
                            console.error("Error signing in with custom token:", error);
                            showMessage(`Authentication failed: ${error.message}. Please check your token.`);
                            await signInAnonymously(authInstance); // Fallback to anonymous
                            setUserId(authInstance.currentUser?.uid);
                        }
                    } else {
                        await signInAnonymously(authInstance);
                        setUserId(authInstance.currentUser?.uid);
                        console.log("Signed in anonymously.");
                    }
                }
                setIsAuthReady(true);
            });

            // Cleanup subscription on component unmount
            return () => unsubscribe();
        } catch (error) {
            console.error("Failed to initialize Firebase:", error);
            showMessage(`Failed to initialize Firebase: ${error.message}. Check console for details.`);
            setIsAuthReady(true); // Set to true even on error to prevent infinite loading state
        }
    }, [showMessage, firebaseConfig, initialAuthToken]); // Added initialAuthToken to dependencies

    return (
        <div className="min-h-screen bg-gray-50 flex flex-col font-inter">
            {/* Styles for animations */}
            <style>
                {`
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                .animate-fade-in {
                    animation: fadeIn 0.5s ease-out forwards;
                }
                .animation-delay-100 { animation-delay: 0.1s; }
                .animation-delay-200 { animation-delay: 0.2s; }
                .animation-delay-300 { animation-delay: 0.3s; }
                .animation-delay-400 { animation-delay: 0.4s; }
                .animation-delay-500 { animation-delay: 0.5s; }
                .animation-delay-600 { animation-delay: 0.6s; }
                .animation-delay-700 { animation-delay: 0.7s; }
                .animation-delay-800 { animation-delay: 0.8s; }
                .animation-delay-900 { animation-delay: 0.9s; }
                .animation-delay-1000 { animation-delay: 1.0s; }
                .animation-delay-1100 { animation-delay: 1.1s; }
                .animation-delay-1200 { animation-delay: 1.2s; }
                .animation-delay-1300 { animation-delay: 1.3s; }
                .animation-delay-1400 { animation-delay: 1.4s; }


                @keyframes slideInUp {
                    from { opacity: 0; transform: translateY(20px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .animate-slide-in-up {
                    animation: slideInUp 0.6s ease-out forwards;
                }

                @keyframes pulse-light {
                    0% { text-shadow: 0 0 0px rgba(0, 0, 0, 0.7); }
                    50% { text-shadow: 0 0 8px rgba(100, 100, 255, 0.8), 0 0 15px rgba(150, 150, 255, 0.6); }
                    100% { text-shadow: 0 0 0px rgba(0, 0, 0, 0.7); }
                }
                .animate-pulse-light {
                    animation: pulse-light 3s infinite ease-in-out;
                }

                .feedback-button {
                    padding: 0.5rem 0.75rem;
                    border-radius: 0.375rem;
                    font-size: 0.875rem;
                    line-height: 1.25rem;
                    transition: background-color 0.2s, transform 0.2s;
                    color: inherit;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                }
                .feedback-button:hover {
                    transform: translateY(-2px);
                }
                .feedback-button.liked {
                    background-color: #d1fae5; /* Green 100 */
                    color: #065f46; /* Green 800 */
                }
                .feedback-button.disliked {
                    background-color: #fee2e2; /* Red 100 */
                    color: #991b1b; /* Red 800 */
                }
                /* Custom arrow for select elements */
                .custom-select-arrow {
                    -webkit-appearance: none;
                    -moz-appearance: none;
                    appearance: none;
                    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='currentColor'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd'%3E%3C/path%3E%3C/svg%3E");
                    background-repeat: no-repeat;
                    background-position: right 0.75rem center;
                    background-size: 1.5em 1.5em;
                    padding-right: 2.5rem; /* Make space for the arrow */
                }
                `}
            </style>

            <header className="bg-white shadow-md p-4">
                <nav className="container mx-auto flex flex-col sm:flex-row justify-between items-center">
                    <h1 className="text-2xl font-bold text-gray-800 mb-2 sm:mb-0">Nithin AI Studio</h1>
                    <div className="flex flex-wrap justify-center gap-2">
                        <button
                            onClick={() => setCurrentPage('home')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'home' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Home
                        </button>
                        <button
                            onClick={() => setCurrentPage('imageGen')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'imageGen' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Image Generator
                        </button>
                        <button
                            onClick={() => setCurrentPage('summarizer')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'summarizer' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Text Summarizer
                        </button>
                        <button
                            onClick={() => setCurrentPage('contentStudio')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'contentStudio' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            AI Content Studio
                        </button>
                        <button
                            onClick={() => setCurrentPage('codeGenerator')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'codeGenerator' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Code Generator
                        </button>
                        {/* New LLM feature buttons */}
                        <button
                            onClick={() => setCurrentPage('creativeWriting')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'creativeWriting' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Creative Writing ‚ú®
                        </button>
                        <button
                            onClick={() => setCurrentPage('mealPlanner')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'mealPlanner' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Meal Planner ‚ú®
                        </button>
                        <button
                            onClick={() => setCurrentPage('translator')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'translator' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Translator ‚ú®
                        </button>
                        {/* New placeholder tool buttons */}
                        <button
                            onClick={() => setCurrentPage('sentimentAnalyzer')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'sentimentAnalyzer' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Sentiment Analyzer ‚ú®
                        </button>
                        <button
                            onClick={() => setCurrentPage('keywordExtractor')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'keywordExtractor' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Keyword Extractor ‚ú®
                        </button>
                        <button
                            onClick={() => setCurrentPage('qaBot')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'qaBot' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Q&A Bot ‚ú®
                        </button>
                        <button
                            onClick={() => setCurrentPage('grammarCorrector')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'grammarCorrector' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Grammar Corrector ‚ú®
                        </button>
                        <button
                            onClick={() => setCurrentPage('codeDebugger')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'codeDebugger' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Code Debugger ‚ú®
                        </button>
                        <button
                            onClick={() => setCurrentPage('recipeAdjuster')}
                            className={`px-4 py-2 rounded-md transition duration-200 ${currentPage === 'recipeAdjuster' ? 'bg-indigo-600 text-white shadow-md' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'}`}
                        >
                            Recipe Adjuster ‚ú®
                        </button>
                    </div>
                </nav>
            </header>

            <main className="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
                {isAuthReady ? (
                    <>
                        {/* Display User ID for debugging/identification purposes */}
                        {userId && (
                            <div className="text-right text-xs text-gray-500 mb-4">
                                User ID: {userId}
                            </div>
                        )}

                        {currentPage === 'home' && <HomeContent />}
                        {currentPage === 'imageGen' && <ImageGeneratorTool showMessage={showMessage} />}
                        {currentPage === 'summarizer' && <TextSummarizerTool showMessage={showMessage} />}
                        {currentPage === 'contentStudio' && <AIContentStudioTool showMessage={showMessage} elevenLabsApiKey={ELEVENLABS_API_KEY} />}
                        {currentPage === 'codeGenerator' && <CodeGeneratorTool showMessage={showMessage} />}
                        {/* Existing LLM feature components rendering */}
                        {currentPage === 'creativeWriting' && <CreativeWritingTool showMessage={showMessage} />}
                        {currentPage === 'mealPlanner' && <MealPlannerTool showMessage={showMessage} />}
                        {currentPage === 'translator' && <LanguageTranslatorTool showMessage={showMessage} />}
                        {/* New placeholder tool components rendering */}
                        {currentPage === 'sentimentAnalyzer' && <SentimentAnalyzerTool showMessage={showMessage} />}
                        {currentPage === 'keywordExtractor' && <KeywordExtractorTool showMessage={showMessage} />}
                        {currentPage === 'qaBot' && <QABotTool showMessage={showMessage} />}
                        {currentPage === 'grammarCorrector' && <GrammarCorrectorTool showMessage={showMessage} />}
                        {currentPage === 'codeDebugger' && <CodeDebuggerTool showMessage={showMessage} />}
                        {currentPage === 'recipeAdjuster' && <RecipeAdjusterTool showMessage={showMessage} />}
                    </>
                ) : (
                    <div className="flex justify-center items-center h-full min-h-[calc(100vh-150px)]">
                        <div className="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-500"></div>
                        <p className="ml-4 text-gray-700 text-lg">Loading AI Studio...</p>
                    </div>
                )}
            </main>

            <CustomMessageBox message={alertMessage} onClose={closeMessage} />
        </div>
    );
}
